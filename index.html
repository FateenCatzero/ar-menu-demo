<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>AR Food Menu - Order Now</title>
    
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');

        :root {
            --light-bg: #ffffff;
            --light-bg-secondary: #f8f9fa;
            --light-text: #1a1a1a;
            --light-border: #e5e7eb;
            --dark-bg: #0f0f0f;
            --dark-bg-secondary: #1a1a1a;
            --dark-text: #ffffff;
            --dark-border: #2a2a2a;
            --color-primary: #3b82f6;
            --color-primary-hover: #2563eb;
            --color-success: #10b981;
            --color-warning: #f59e0b;
            --color-danger: #ef4444;
            --color-favorite: #ef4444;
            --color-star: #fbbf24;
            --color-cart: #8b5cf6;
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            --radius-full: 9999px;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
            height: 100vh;
            overflow: hidden;
            transition: background 0.3s ease, color 0.3s ease;
            position: fixed;
            width: 100%;
        }

        body.light-theme {
            background: var(--light-bg);
            color: var(--light-text);
        }

        body.dark-theme {
            background: var(--dark-bg);
            color: var(--dark-text);
        }

        /* ScaleXR Branding - NOT FIXED, scrolls with page */
        .scalexr-branding {
            position: absolute;
            top: 12px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        /* Hide ScaleXR when menu is open */
        .side-menu.open ~ .scalexr-branding {
            opacity: 0;
        }

        .scalexr-logo {
            font-family: 'Inter', sans-serif;
            font-size: 20px;
            font-weight: 800;
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, var(--color-primary), var(--color-success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 2px 8px rgba(59, 130, 246, 0.2);
        }

        .dark-theme .scalexr-logo {
            background: linear-gradient(135deg, #60a5fa, #34d399);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Search Bar - Below navigation buttons, above info card */
        .search-container {
            position: fixed;
            top: 120px;
            left: 12px;
            right: 12px;
            z-index: 91;
            max-width: 500px;
            margin: 0 auto;
            pointer-events: none;
            display: none;
            transition: top 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .search-container.show {
            display: block;
            pointer-events: auto;
        }

        .search-wrapper {
            position: relative;
        }

        .search-bar {
            width: 100%;
            padding: 12px 16px 12px 44px;
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid var(--light-border);
            border-radius: var(--radius-full);
            font-size: 15px;
            color: var(--light-text);
            box-shadow: var(--shadow-lg);
            transition: all 0.2s;
        }

        .dark-theme .search-bar {
            background: rgba(26, 26, 26, 0.95);
            border-color: var(--dark-border);
            color: white;
        }

        .search-bar:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            opacity: 0.5;
        }

        .search-clear {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.1);
            border: none;
            color: var(--light-text);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .dark-theme .search-clear {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .search-clear.show {
            display: flex;
        }

        .search-results {
            margin-top: 8px;
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid var(--light-border);
            border-radius: var(--radius-lg);
            max-height: 400px;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            display: none;
        }

        .dark-theme .search-results {
            background: rgba(26, 26, 26, 0.95);
            border-color: var(--dark-border);
        }

        .search-results.show {
            display: block;
        }

        .search-result-item {
            padding: 12px 16px;
            border-bottom: 1px solid var(--light-border);
            cursor: pointer;
            transition: all 0.2s;
        }

        .dark-theme .search-result-item {
            border-bottom-color: var(--dark-border);
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-item:hover {
            background: var(--light-bg-secondary);
        }

        .dark-theme .search-result-item:hover {
            background: var(--dark-bg);
        }

        .search-result-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .search-result-meta {
            font-size: 12px;
            opacity: 0.6;
        }

        .search-no-results {
            padding: 40px 20px;
            text-align: center;
            opacity: 0.5;
            font-size: 14px;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px 20px;
            border-radius: var(--radius-full);
            z-index: 300;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 600;
            box-shadow: var(--shadow-xl);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .toast.success {
            background: var(--color-success);
        }

        .toast.error {
            background: var(--color-danger);
        }

        /* Welcome Screen */
        .welcome-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 200;
            display: none;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            padding: var(--space-lg);
        }

        .welcome-overlay.show {
            display: flex;
        }

        .welcome-content {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            max-width: 90%;
            width: 400px;
            text-align: center;
            box-shadow: var(--shadow-xl);
        }

        .dark-theme .welcome-content {
            background: var(--dark-bg-secondary);
            color: white;
        }

        .welcome-icon {
            font-size: 64px;
            margin-bottom: var(--space-md);
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .welcome-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: var(--space-sm);
        }

        .welcome-text {
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: var(--space-lg);
            opacity: 0.8;
        }

        .welcome-steps {
            text-align: left;
            margin: var(--space-lg) 0;
            padding: var(--space-md);
            background: var(--light-bg-secondary);
            border-radius: var(--radius-md);
        }

        .dark-theme .welcome-steps {
            background: var(--dark-bg);
        }

        .welcome-step {
            display: flex;
            align-items: flex-start;
            gap: var(--space-sm);
            margin-bottom: var(--space-sm);
            font-size: 13px;
            line-height: 1.5;
        }

        .welcome-step:last-child {
            margin-bottom: 0;
        }

        .welcome-step-icon {
            font-size: 20px;
            flex-shrink: 0;
        }

        .welcome-button {
            width: 100%;
            padding: 14px;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .welcome-button:active {
            transform: scale(0.98);
            background: var(--color-primary-hover);
        }

        /* Tutorial Modal */
        .tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 199;
            display: none;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            padding: var(--space-lg);
        }

        .tutorial-overlay.show {
            display: flex;
        }

        .tutorial-content {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            max-width: 90%;
            width: 400px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
        }

        .dark-theme .tutorial-content {
            background: var(--dark-bg-secondary);
            color: white;
        }

        .tutorial-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
            padding-bottom: var(--space-md);
            border-bottom: 2px solid var(--light-border);
        }

        .dark-theme .tutorial-header {
            border-bottom-color: var(--dark-border);
        }

        .tutorial-title {
            font-size: 22px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tutorial-close {
            background: rgba(0, 0, 0, 0.8);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dark-theme .tutorial-close {
            background: rgba(255, 255, 255, 0.9);
            color: var(--dark-bg);
        }

        .tutorial-step {
            display: flex;
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
            padding: var(--space-md);
            background: var(--light-bg-secondary);
            border-radius: var(--radius-md);
        }

        .dark-theme .tutorial-step {
            background: var(--dark-bg);
        }

        .tutorial-step-icon {
            font-size: 32px;
            flex-shrink: 0;
        }

        .tutorial-step-content {
            flex: 1;
        }

        .tutorial-step-title {
            font-size: 15px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .tutorial-step-text {
            font-size: 13px;
            line-height: 1.5;
            opacity: 0.8;
        }

        /* Top Navigation */
        .top-nav {
            position: fixed;
            top: 48px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: transparent;
            z-index: 95;
            pointer-events: none;
        }

        .nav-left, .nav-right {
            display: flex;
            gap: 8px;
            align-items: center;
            pointer-events: auto;
        }

        .icon-btn {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid var(--light-border);
            color: var(--light-text);
            width: 44px;
            height: 44px;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
            box-shadow: var(--shadow-md);
            font-weight: 600;
        }

        .dark-theme .icon-btn {
            background: rgba(26, 26, 26, 0.95);
            border: 1px solid var(--dark-border);
            color: white;
        }

        .icon-btn:active {
            transform: scale(0.95);
        }

        .counter-badge {
            position: absolute;
            top: -6px;
            right: -6px;
            background: var(--color-danger);
            color: white;
            min-width: 20px;
            height: 20px;
            padding: 0 5px;
            border-radius: var(--radius-full);
            font-size: 11px;
            font-weight: 700;
            display: none;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--light-bg);
        }

        .dark-theme .counter-badge {
            border-color: var(--dark-bg);
        }

        .counter-badge.show {
            display: flex;
        }

        .counter-badge.cart-badge {
            background: var(--color-cart);
        }

        /* Side Menu */
        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 98;
            display: none;
            backdrop-filter: blur(8px);
        }

        .menu-overlay.show {
            display: block;
        }

        .side-menu {
            position: fixed;
            top: 0;
            left: -100%;
            width: 85%;
            max-width: 360px;
            height: 100%;
            background: white;
            color: var(--light-text);
            z-index: 99;
            transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
            padding-bottom: 60px;
            box-shadow: var(--shadow-xl);
        }

        .dark-theme .side-menu {
            background: var(--dark-bg-secondary);
            color: white;
        }

        .side-menu.open {
            left: 0;
        }

        .menu-header {
            padding: var(--space-lg);
            padding-top: 60px;
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-hover));
            position: sticky;
            top: 0;
            z-index: 10;
            color: white;
        }

        .menu-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 6px;
        }

        .menu-subtitle {
            font-size: 13px;
            opacity: 0.9;
        }

        /* User Section in Menu */
        .user-section {
            padding: var(--space-md);
            background: var(--light-bg-secondary);
            border-bottom: 1px solid var(--light-border);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .dark-theme .user-section {
            background: var(--dark-bg);
            border-bottom-color: var(--dark-border);
        }

        .user-avatar {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-full);
            background: var(--color-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 700;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-size: 15px;
            font-weight: 700;
        }

        .user-email {
            font-size: 12px;
            opacity: 0.6;
        }

        .login-prompt {
            flex: 1;
            font-size: 13px;
        }

        .login-btn-small {
            padding: 8px 16px;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
        }

        .logout-btn {
            padding: 6px 12px;
            background: var(--color-danger);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
        }

        .menu-tabs {
            display: flex;
            gap: 8px;
            padding: var(--space-md);
            background: var(--light-bg-secondary);
            position: sticky;
            top: 115px;
            z-index: 9;
            border-bottom: 1px solid var(--light-border);
        }

        .dark-theme .menu-tabs {
            background: var(--dark-bg);
            border-bottom-color: var(--dark-border);
        }

        .menu-tab {
            flex: 1;
            padding: 10px;
            background: transparent;
            border: 1px solid var(--light-border);
            color: var(--light-text);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
            font-weight: 600;
        }

        .dark-theme .menu-tab {
            border-color: var(--dark-border);
            color: white;
        }

        .menu-tab.active {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }

        .restaurant-section {
            margin: var(--space-md);
        }

        .restaurant-header {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: 12px;
            background: var(--light-bg-secondary);
            border-radius: var(--radius-md);
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid var(--light-border);
        }

        .dark-theme .restaurant-header {
            background: var(--dark-bg);
            border-color: var(--dark-border);
        }

        .restaurant-icon {
            font-size: 24px;
        }

        .restaurant-name {
            font-size: 16px;
            font-weight: 600;
            flex: 1;
        }

        .expand-icon {
            font-size: 16px;
            transition: transform 0.3s;
            color: var(--color-primary);
        }

        .restaurant-header.expanded .expand-icon {
            transform: rotate(180deg);
        }

        .category-section {
            margin-left: 12px;
            margin-bottom: 12px;
            display: none;
        }

        .category-section.show {
            display: block;
        }

        .category-header {
            font-size: 11px;
            font-weight: 700;
            color: var(--color-primary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            padding-left: 8px;
        }

        .menu-item {
            background: white;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid var(--light-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
        }

        .dark-theme .menu-item {
            background: var(--dark-bg);
            border-color: var(--dark-border);
        }

        .menu-item:active {
            transform: scale(0.98);
        }

        .menu-item.active {
            border-color: var(--color-success);
            background: rgba(16, 185, 129, 0.05);
        }

        .menu-item.in-cart {
            border-color: var(--color-cart);
            background: rgba(139, 92, 246, 0.05);
        }

        .menu-item-content {
            flex: 1;
        }

        .menu-item-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .menu-item-name {
            font-size: 14px;
            font-weight: 600;
            flex: 1;
        }

        .menu-item-rating {
            display: flex;
            align-items: center;
            gap: 3px;
            font-size: 11px;
            font-weight: 600;
            color: var(--color-star);
            white-space: nowrap;
        }

        .menu-item-details {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        .menu-item-price {
            font-size: 16px;
            color: var(--color-primary);
            font-weight: 700;
        }

        .menu-item-views {
            font-size: 10px;
            color: #6b7280;
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .menu-item-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .item-fav-btn {
            background: none;
            border: none;
            font-size: 22px;
            cursor: pointer;
            padding: 8px;
            transition: transform 0.2s;
        }

        .item-fav-btn:active {
            transform: scale(1.2);
        }

        .quick-add-btn {
            background: var(--color-success);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: var(--radius-sm);
            font-size: 11px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .quick-add-btn:active {
            transform: scale(0.95);
        }

        .cart-qty-badge {
            background: var(--color-cart);
            color: white;
            padding: 2px 6px;
            border-radius: var(--radius-sm);
            font-size: 10px;
            font-weight: 700;
        }

        .empty-state {
            text-align: center;
            padding: 40px var(--space-md);
            opacity: 0.5;
        }

        .empty-state-icon {
            font-size: 56px;
            margin-bottom: var(--space-md);
        }

        .empty-state-text {
            font-size: 14px;
            line-height: 1.6;
        }

        /* Info Card - SLIGHTLY TRANSPARENT */
        .info-card {
            position: fixed;
            top: 118px;
            left: 12px;
            right: 12px;
            background: rgba(255, 255, 255, 0.95); /* Slightly transparent */
            backdrop-filter: blur(20px);
            color: var(--light-text);
            border-radius: var(--radius-lg);
            z-index: 90;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--light-border);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            max-width: 500px;
            margin: 0 auto;
        }

        .dark-theme .info-card {
            background: rgba(26, 26, 26, 0.95); /* Slightly transparent */
            color: white;
            border-color: var(--dark-border);
        }

        .info-card.minimized {
            top: 118px;
        }

        /* Push info card down when search is open - HIGHER SPECIFICITY */
        .info-card.search-active,
        .info-card.minimized.search-active {
            top: 170px !important;
        }

        .info-card-content {
            padding: 16px;
            transition: all 0.3s ease;
        }

        .info-card.minimized .info-card-content {
            padding: 12px 16px;
        }

        .info-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 12px;
        }

        .info-card.minimized .info-header {
            margin-bottom: 0;
            align-items: center;
        }

        .info-main {
            flex: 1;
            min-width: 0;
        }

        .info-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .food-name {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
            transition: font-size 0.3s;
            line-height: 1.3;
        }

        .info-card.minimized .food-name {
            font-size: 14px;
            margin-bottom: 0;
        }

        .food-price {
            font-size: 22px;
            color: var(--color-primary);
            font-weight: 700;
            transition: font-size 0.3s;
        }

        .info-card.minimized .food-price {
            font-size: 16px;
        }

        .minimize-btn, .info-fav-btn {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: var(--radius-md);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .dark-theme .minimize-btn,
        .dark-theme .info-fav-btn {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(0, 0, 0, 0.2);
            color: var(--dark-bg);
        }

        .minimize-btn:active,
        .info-fav-btn:active {
            transform: scale(0.95);
        }

        .info-details {
            opacity: 1;
            max-height: 500px;
            transition: all 0.3s ease;
        }

        .info-card.minimized .info-details {
            opacity: 0;
            max-height: 0;
            overflow: hidden;
        }

        /* Quantity Selector in Info Card */
        .qty-selector {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 12px 0;
            padding: 12px;
            background: var(--light-bg-secondary);
            border-radius: var(--radius-md);
        }

        .dark-theme .qty-selector {
            background: var(--dark-bg);
        }

        .qty-label {
            font-size: 13px;
            font-weight: 600;
            opacity: 0.7;
        }

        .qty-controls {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            justify-content: flex-end;
        }

        .qty-btn {
            background: var(--color-primary);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: var(--radius-md);
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .qty-btn:active {
            transform: scale(0.95);
        }

        .qty-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .qty-display {
            font-size: 18px;
            font-weight: 700;
            min-width: 30px;
            text-align: center;
        }

        .food-rating {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 12px 0;
            padding: 12px;
            background: var(--light-bg-secondary);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s;
        }

        .dark-theme .food-rating {
            background: var(--dark-bg);
        }

        .food-rating:active {
            transform: scale(0.98);
        }

        .rating-stars {
            display: flex;
            align-items: center;
            gap: 2px;
            font-size: 16px;
        }

        .rating-info {
            flex: 1;
        }

        .rating-score {
            font-size: 20px;
            font-weight: 700;
            color: var(--color-star);
            line-height: 1;
        }

        .rating-count {
            font-size: 11px;
            opacity: 0.6;
            margin-top: 2px;
        }

        .rating-arrow {
            font-size: 16px;
            opacity: 0.4;
        }

        .food-meta {
            font-size: 12px;
            opacity: 0.6;
            display: flex;
            align-items: center;
            gap: 6px;
            flex-wrap: wrap;
        }

        /* Reviews Modal */
        .reviews-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 149;
            display: none;
            backdrop-filter: blur(8px);
        }

        .reviews-overlay.show {
            display: block;
        }

        .reviews-modal {
            position: fixed;
            bottom: -100%;
            left: 0;
            right: 0;
            max-height: 80vh;
            background: rgba(255, 255, 255, 0.98); /* Slightly transparent */
            border-radius: var(--radius-xl) var(--radius-xl) 0 0;
            padding: var(--space-lg);
            z-index: 150;
            transition: bottom 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 -4px 32px rgba(0, 0, 0, 0.2);
            overflow-y: auto;
        }

        .dark-theme .reviews-modal {
            background: rgba(26, 26, 26, 0.98); /* Slightly transparent */
            color: white;
        }

        .reviews-modal.show {
            bottom: 0;
        }

        .reviews-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
            padding-bottom: var(--space-md);
            border-bottom: 1px solid var(--light-border);
        }

        .dark-theme .reviews-header {
            border-bottom-color: var(--dark-border);
        }

        .reviews-title {
            font-size: 20px;
            font-weight: 700;
        }

        .reviews-close {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 24px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .dark-theme .reviews-close {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(0, 0, 0, 0.2);
            color: var(--dark-bg);
        }

        .reviews-close:active {
            transform: scale(0.95);
        }

        .review-item {
            padding: var(--space-md);
            border-bottom: 1px solid var(--light-border);
        }

        .dark-theme .review-item {
            border-bottom-color: var(--dark-border);
        }

        .review-item:last-child {
            border-bottom: none;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .review-author {
            font-weight: 600;
            font-size: 14px;
        }

        .review-stars {
            color: var(--color-star);
            font-size: 14px;
        }

        .review-date {
            font-size: 11px;
            opacity: 0.5;
            margin-bottom: 8px;
        }

        .review-text {
            font-size: 13px;
            line-height: 1.6;
            opacity: 0.8;
        }

        /* AR Viewer with Grid Floor - Positioned below info card */
        model-viewer {
            width: 100%;
            height: 100%;
            --poster-color: transparent;
            padding-top: 200px;
            transition: padding-top 0.3s ease;
        }

        /* Adjust when info card is minimized */
        body.info-minimized model-viewer {
            padding-top: 180px;
        }

        /* Adjust when search is active */
        body.search-active model-viewer {
            padding-top: 280px;
        }

        .grid-floor {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 30%;
            background: 
                linear-gradient(to bottom, transparent 0%, rgba(0,0,0,0.02) 100%),
                repeating-linear-gradient(
                    0deg,
                    rgba(0,0,0,0.03) 0px,
                    transparent 1px,
                    transparent 20px,
                    rgba(0,0,0,0.03) 21px
                ),
                repeating-linear-gradient(
                    90deg,
                    rgba(0,0,0,0.03) 0px,
                    transparent 1px,
                    transparent 20px,
                    rgba(0,0,0,0.03) 21px
                );
            pointer-events: none;
            z-index: 1;
        }

        .dark-theme .grid-floor {
            background: 
                linear-gradient(to bottom, transparent 0%, rgba(255,255,255,0.02) 100%),
                repeating-linear-gradient(
                    0deg,
                    rgba(255,255,255,0.05) 0px,
                    transparent 1px,
                    transparent 20px,
                    rgba(255,255,255,0.05) 21px
                ),
                repeating-linear-gradient(
                    90deg,
                    rgba(255,255,255,0.05) 0px,
                    transparent 1px,
                    transparent 20px,
                    rgba(255,255,255,0.05) 21px
                );
        }

        /* Loading Overlay */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 50;
            flex-direction: column;
            gap: var(--space-lg);
        }

        .loading-overlay.show {
            display: flex;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: white;
            font-size: 15px;
            font-weight: 600;
        }

        .loading-progress {
            width: 180px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-full);
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: var(--color-success);
            width: 0%;
            transition: width 0.3s;
        }

        /* Error Message */
        .error-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            color: var(--light-text);
            padding: var(--space-lg);
            border-radius: var(--radius-xl);
            text-align: center;
            z-index: 60;
            max-width: 80%;
            display: none;
            flex-direction: column;
            gap: var(--space-md);
            box-shadow: var(--shadow-xl);
        }

        .dark-theme .error-message {
            background: var(--dark-bg-secondary);
            color: white;
        }

        .error-message.show {
            display: flex;
        }

        .error-icon {
            font-size: 42px;
        }

        .error-title {
            font-size: 18px;
            font-weight: 700;
        }

        .error-text {
            font-size: 13px;
            line-height: 1.6;
            opacity: 0.7;
        }

        .error-close {
            background: var(--color-primary);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
        }

        /* Bottom Action Bar */
        .bottom-bar {
            position: fixed;
            bottom: 20px;
            left: 12px;
            right: 12px;
            display: flex;
            gap: 12px;
            z-index: 85;
            align-items: center;
            justify-content: center;
            max-width: 500px;
            margin: 0 auto;
        }

        .ar-button {
            background: var(--color-primary);
            color: white;
            border: none;
            padding: 14px 24px;
            font-size: 15px;
            font-weight: 700;
            border-radius: var(--radius-full);
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            max-width: 200px;
            justify-content: center;
        }

        .ar-button:active {
            transform: scale(0.98);
        }

        .add-to-cart-button {
            background: var(--color-success);
            flex: 1;
            max-width: none;
        }

        .action-btn {
            background: white;
            border: 1px solid var(--light-border);
            width: 52px;
            height: 52px;
            border-radius: var(--radius-full);
            cursor: pointer;
            font-size: 20px;
            box-shadow: var(--shadow-md);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .dark-theme .action-btn {
            background: var(--dark-bg-secondary);
            border-color: var(--dark-border);
        }

        .action-btn:active {
            transform: scale(0.95);
        }

        /* Help Button - ALWAYS VISIBLE */
        .help-btn {
            position: fixed;
            bottom: 88px;
            right: 12px;
            background: white;
            border: 1px solid var(--light-border);
            color: var(--light-text);
            width: 52px;
            height: 52px;
            border-radius: var(--radius-full);
            cursor: pointer;
            font-size: 22px;
            box-shadow: var(--shadow-md);
            z-index: 85;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .dark-theme .help-btn {
            background: var(--dark-bg-secondary);
            border-color: var(--dark-border);
            color: white;
        }

        .help-btn:active {
            transform: scale(0.95);
        }

        /* Cart Modal */
        .cart-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 149;
            display: none;
            backdrop-filter: blur(8px);
        }

        .cart-overlay.show {
            display: block;
        }

        .cart-modal {
            position: fixed;
            bottom: -100%;
            left: 0;
            right: 0;
            max-height: 85vh;
            background: rgba(255, 255, 255, 0.98);
            border-radius: var(--radius-xl) var(--radius-xl) 0 0;
            padding: var(--space-lg);
            z-index: 150;
            transition: bottom 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 -4px 32px rgba(0, 0, 0, 0.2);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .dark-theme .cart-modal {
            background: rgba(26, 26, 26, 0.98);
            color: white;
        }

        .cart-modal.show {
            bottom: 0;
        }

        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
            padding-bottom: var(--space-md);
            border-bottom: 1px solid var(--light-border);
            flex-shrink: 0;
        }

        .dark-theme .cart-header {
            border-bottom-color: var(--dark-border);
        }

        .cart-title {
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .cart-close {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 24px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .dark-theme .cart-close {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(0, 0, 0, 0.2);
            color: var(--dark-bg);
        }

        .cart-close:active {
            transform: scale(0.95);
        }

        .cart-items-container {
            flex: 1;
            overflow-y: auto;
            margin-bottom: var(--space-lg);
        }

        .cart-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: var(--space-md);
            background: var(--light-bg-secondary);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-sm);
        }

        .dark-theme .cart-item {
            background: var(--dark-bg);
        }

        .cart-item-icon {
            font-size: 32px;
            flex-shrink: 0;
        }

        .cart-item-info {
            flex: 1;
            min-width: 0;
        }

        .cart-item-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .cart-item-price {
            font-size: 13px;
            color: var(--color-primary);
            font-weight: 700;
        }

        .cart-item-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .cart-qty-btn {
            background: var(--color-primary);
            color: white;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: var(--radius-sm);
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cart-qty-btn:active {
            transform: scale(0.95);
        }

        .cart-qty-display {
            font-size: 15px;
            font-weight: 700;
            min-width: 24px;
            text-align: center;
        }

        .cart-remove-btn {
            background: var(--color-danger);
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: var(--radius-sm);
            font-size: 16px;
            cursor: pointer;
        }

        .cart-remove-btn:active {
            transform: scale(0.95);
        }

        .cart-summary {
            padding: var(--space-md);
            background: var(--light-bg-secondary);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-md);
            flex-shrink: 0;
        }

        .dark-theme .cart-summary {
            background: var(--dark-bg);
        }

        .cart-summary-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .cart-summary-row:last-child {
            margin-bottom: 0;
        }

        .cart-summary-label {
            opacity: 0.7;
        }

        .cart-summary-value {
            font-weight: 700;
        }

        .cart-total {
            font-size: 18px;
            color: var(--color-success);
            padding-top: 8px;
            border-top: 1px solid var(--light-border);
            margin-top: 8px;
        }

        .dark-theme .cart-total {
            border-top-color: var(--dark-border);
        }

        .checkout-btn {
            width: 100%;
            padding: 16px;
            background: var(--color-success);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .checkout-btn:active {
            transform: scale(0.98);
        }

        .checkout-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Checkout Modal */
        .checkout-modal {
            position: fixed;
            bottom: -100%;
            left: 0;
            right: 0;
            max-height: 90vh;
            background: rgba(255, 255, 255, 0.98);
            border-radius: var(--radius-xl) var(--radius-xl) 0 0;
            padding: var(--space-lg);
            z-index: 160;
            transition: bottom 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 -4px 32px rgba(0, 0, 0, 0.2);
            overflow-y: auto;
        }

        .dark-theme .checkout-modal {
            background: rgba(26, 26, 26, 0.98);
            color: white;
        }

        .checkout-modal.show {
            bottom: 0;
        }

        .checkout-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
            padding-bottom: var(--space-md);
            border-bottom: 1px solid var(--light-border);
        }

        .dark-theme .checkout-header {
            border-bottom-color: var(--dark-border);
        }

        .checkout-title {
            font-size: 20px;
            font-weight: 700;
        }

        .checkout-section {
            margin-bottom: var(--space-lg);
        }

        .checkout-section-title {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: var(--space-sm);
            opacity: 0.7;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group {
            margin-bottom: var(--space-md);
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            background: var(--light-bg-secondary);
            border: 1px solid var(--light-border);
            border-radius: var(--radius-md);
            font-size: 15px;
            color: var(--light-text);
        }

        .dark-theme .form-input {
            background: var(--dark-bg);
            border-color: var(--dark-border);
            color: white;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .payment-methods {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
        }

        .payment-method {
            padding: 16px 8px;
            background: var(--light-bg-secondary);
            border: 2px solid var(--light-border);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .dark-theme .payment-method {
            background: var(--dark-bg);
            border-color: var(--dark-border);
        }

        .payment-method.active {
            border-color: var(--color-success);
            background: rgba(16, 185, 129, 0.1);
        }

        .payment-method-icon {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .payment-method-name {
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .payment-method-gst {
            font-size: 10px;
            color: var(--color-primary);
            font-weight: 700;
        }

        .order-summary-mini {
            padding: var(--space-md);
            background: var(--light-bg-secondary);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-lg);
        }

        .dark-theme .order-summary-mini {
            background: var(--dark-bg);
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .summary-row:last-child {
            margin-bottom: 0;
        }

        .summary-total {
            font-size: 16px;
            font-weight: 700;
            color: var(--color-success);
            border-top: 1px solid var(--light-border);
            padding-top: 8px;
            margin-top: 8px;
        }

        .dark-theme .summary-total {
            border-top-color: var(--dark-border);
        }

        .place-order-btn {
            width: 100%;
            padding: 16px;
            background: var(--color-success);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }

        .place-order-btn:active {
            transform: scale(0.98);
        }

        .place-order-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Order Confirmation Modal */
        .order-confirmation-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 199;
            display: none;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            padding: var(--space-lg);
        }

        .order-confirmation-overlay.show {
            display: flex;
        }

        .order-confirmation-content {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            max-width: 90%;
            width: 400px;
            text-align: center;
            box-shadow: var(--shadow-xl);
        }

        .dark-theme .order-confirmation-content {
            background: var(--dark-bg-secondary);
            color: white;
        }

        .confirmation-icon {
            font-size: 80px;
            margin-bottom: var(--space-md);
            animation: bounce 1s;
        }

        .confirmation-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: var(--space-sm);
            color: var(--color-success);
        }

        .confirmation-text {
            font-size: 14px;
            line-height: 1.6;
            opacity: 0.8;
            margin-bottom: var(--space-lg);
        }

        .order-number {
            font-size: 32px;
            font-weight: 700;
            color: var(--color-primary);
            margin: var(--space-lg) 0;
        }

        .confirmation-details {
            padding: var(--space-md);
            background: var(--light-bg-secondary);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-lg);
            text-align: left;
        }

        .dark-theme .confirmation-details {
            background: var(--dark-bg);
        }

        .confirmation-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .confirmation-row:last-child {
            margin-bottom: 0;
        }

        .confirmation-button {
            width: 100%;
            padding: 14px;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .confirmation-button:active {
            transform: scale(0.98);
        }

        /* Login/Signup Modal */
        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 199;
            display: none;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            padding: var(--space-lg);
        }

        .auth-overlay.show {
            display: flex;
        }

        .auth-content {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            max-width: 90%;
            width: 400px;
            box-shadow: var(--shadow-xl);
        }

        .dark-theme .auth-content {
            background: var(--dark-bg-secondary);
            color: white;
        }

        .auth-header {
            text-align: center;
            margin-bottom: var(--space-lg);
        }

        .auth-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: var(--space-sm);
        }

        .auth-subtitle {
            font-size: 13px;
            opacity: 0.7;
        }

        .auth-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: var(--space-lg);
        }

        .auth-tab {
            flex: 1;
            padding: 10px;
            background: transparent;
            border: 1px solid var(--light-border);
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .dark-theme .auth-tab {
            border-color: var(--dark-border);
        }

        .auth-tab.active {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .auth-button {
            width: 100%;
            padding: 14px;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .auth-button:active {
            transform: scale(0.98);
        }

        .auth-divider {
            text-align: center;
            margin: var(--space-lg) 0;
            opacity: 0.5;
            font-size: 13px;
        }

        .auth-close-btn {
            width: 100%;
            padding: 12px;
            background: var(--light-bg-secondary);
            color: var(--light-text);
            border: none;
            border-radius: var(--radius-md);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }

        .dark-theme .auth-close-btn {
            background: var(--dark-bg);
            color: white;
        }

        .share-modal {
            position: fixed;
            bottom: -100%;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.98);
            border-radius: var(--radius-xl) var(--radius-xl) 0 0;
            padding: var(--space-lg);
            z-index: 201;
            transition: bottom 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 -4px 32px rgba(0, 0, 0, 0.2);
        }

        .dark-theme .share-modal {
            background: rgba(26, 26, 26, 0.98);
            color: white;
        }

        .share-modal.show {
            bottom: 0;
        }

        .share-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 200;
            display: none;
            backdrop-filter: blur(8px);
        }

        .share-overlay.show {
            display: block;
        }

        .share-header {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: var(--space-lg);
            text-align: center;
        }

        .share-options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: var(--space-lg);
        }

        .share-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 16px 8px;
            background: var(--light-bg-secondary);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .dark-theme .share-option {
            background: var(--dark-bg);
        }

        .share-option:active {
            transform: scale(0.95);
            border-color: var(--color-primary);
        }

        .share-option-icon {
            font-size: 28px;
        }

        .share-option-label {
            font-size: 11px;
            font-weight: 600;
        }

        .share-close {
            width: 100%;
            padding: 14px;
            background: var(--light-bg-secondary);
            color: var(--light-text);
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .dark-theme .share-close {
            background: var(--dark-bg);
            color: white;
        }

        .share-close:active {
            transform: scale(0.98);
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 380px) {
            .food-name {
                font-size: 16px;
            }
            
            .ar-button, .add-to-cart-button {
                padding: 12px 20px;
                font-size: 14px;
            }
            
            .share-options {
                grid-template-columns: repeat(2, 1fr);
            }

            .action-btn, .help-btn {
                width: 48px;
                height: 48px;
            }
        }
    </style>
</head>
<body class="light-theme">

    <!-- ScaleXR Branding -->
    <div class="scalexr-branding">
        <div class="scalexr-logo">ScaleXR</div>
    </div>

    <!-- Search Container -->
    <div class="search-container" id="searchContainer">
        <div style="position: relative;">
            <span class="search-icon"></span>
            <input type="text" class="search-bar" id="searchBar" placeholder="Search restaurants or items...">
            <button class="search-clear" id="searchClear"></button>
        </div>
        <div class="search-results" id="searchResults"></div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <span id="toastIcon"></span>
        <span id="toastMessage">Item added to cart!</span>
    </div>

    <!-- Welcome Screen -->
    <div class="welcome-overlay" id="welcomeOverlay">
        <div class="welcome-content">
            <div class="welcome-icon"></div>
            <div class="welcome-title">Welcome to AR Menu!</div>
            <div class="welcome-text">View food items in augmented reality and order easily</div>
            
            <div class="welcome-steps">
                <div class="welcome-step">
                    <span class="welcome-step-icon"></span>
                    <span>Browse menu and view items in AR</span>
                </div>
                <div class="welcome-step">
                    <span class="welcome-step-icon"></span>
                    <span>Add items to cart with custom quantities</span>
                </div>
                <div class="welcome-step">
                    <span class="welcome-step-icon"></span>
                    <span>Enter table number and choose payment: Cash (15% GST) or Card (5% GST)</span>
                </div>
            </div>
            
            <button class="welcome-button" id="welcomeButton">Get Started</button>
        </div>
    </div>

    <!-- Tutorial Modal -->
    <div class="tutorial-overlay" id="tutorialOverlay">
        <div class="tutorial-content">
            <div class="tutorial-header">
                <div class="tutorial-title"> App Guide</div>
                <button class="tutorial-close" id="tutorialClose"></button>
            </div>

            <div class="tutorial-step">
                <div class="tutorial-step-icon"></div>
                <div class="tutorial-step-content">
                    <div class="tutorial-step-title">Browse Menu</div>
                    <div class="tutorial-step-text">Tap the menu button to view all available items from different restaurants</div>
                </div>
            </div>

            <div class="tutorial-step">
                <div class="tutorial-step-icon"></div>
                <div class="tutorial-step-content">
                    <div class="tutorial-step-title">Add to Cart</div>
                    <div class="tutorial-step-text">Use + button to quick add from menu, or adjust quantity before adding from item view</div>
                </div>
            </div>

            <div class="tutorial-step">
                <div class="tutorial-step-icon"></div>
                <div class="tutorial-step-content">
                    <div class="tutorial-step-title">View in AR</div>
                    <div class="tutorial-step-text">Tap "View in AR" to place food on your table using your camera</div>
                </div>
            </div>

            <div class="tutorial-step">
                <div class="tutorial-step-icon"></div>
                <div class="tutorial-step-content">
                    <div class="tutorial-step-title">Adjust Quantity</div>
                    <div class="tutorial-step-text">Use +/- buttons to change quantity before adding to cart or in the cart itself</div>
                </div>
            </div>

            <div class="tutorial-step">
                <div class="tutorial-step-icon"></div>
                <div class="tutorial-step-content">
                    <div class="tutorial-step-title">Place Order</div>
                    <div class="tutorial-step-text">Enter table number, choose payment (Cash 15% GST, Card Machine 5% GST, or Online Card 5% GST)</div>
                </div>
            </div>

            <div class="tutorial-step">
                <div class="tutorial-step-icon"></div>
                <div class="tutorial-step-content">
                    <div class="tutorial-step-title">Add to Favorites</div>
                    <div class="tutorial-step-text">Tap heart icon in menu or on info card (top right) to save your favorite items</div>
                </div>
            </div>

            <div class="tutorial-step">
                <div class="tutorial-step-icon"></div>
                <div class="tutorial-step-content">
                    <div class="tutorial-step-title">Expand/Collapse Info</div>
                    <div class="tutorial-step-text">Use arrow buttons to expand or minimize the info card for a better view</div>
                </div>
            </div>

            <div class="tutorial-step">
                <div class="tutorial-step-icon"></div>
                <div class="tutorial-step-content">
                    <div class="tutorial-step-title">Login for More</div>
                    <div class="tutorial-step-text">Login to save favorites permanently and track your order history</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Login/Signup Modal -->
    <div class="auth-overlay" id="authOverlay">
        <div class="auth-content">
            <div class="auth-header">
                <div class="auth-title"> Account</div>
                <div class="auth-subtitle">Login or create an account</div>
            </div>

            <div class="auth-tabs">
                <button class="auth-tab active" id="loginTab">Login</button>
                <button class="auth-tab" id="signupTab">Sign Up</button>
            </div>

            <!-- Login Form -->
            <form class="auth-form active" id="loginForm">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="loginEmail" placeholder="your@email.com" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="" required>
                </div>
                <button type="submit" class="auth-button">Login</button>
            </form>

            <!-- Signup Form -->
            <form class="auth-form" id="signupForm">
                <div class="form-group">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-input" id="signupName" placeholder="Your Name" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="signupEmail" placeholder="your@email.com" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="signupPassword" placeholder="" required>
                </div>
                <button type="submit" class="auth-button">Sign Up</button>
            </form>

            <div class="auth-divider"></div>
            <button class="auth-close-btn" id="authCloseBtn">Continue as Guest</button>
        </div>
    </div>

    <!-- Order Confirmation Modal -->
    <div class="order-confirmation-overlay" id="orderConfirmationOverlay">
        <div class="order-confirmation-content">
            <div class="confirmation-icon"></div>
            <div class="confirmation-title">Order Placed!</div>
            <div class="confirmation-text">Your order has been sent to the kitchen</div>
            
            <div class="order-number" id="orderNumber">#0000</div>
            
            <div class="confirmation-details">
                <div class="confirmation-row">
                    <span>Table Number:</span>
                    <strong id="confirmTableNumber">-</strong>
                </div>
                <div class="confirmation-row">
                    <span>Payment Method:</span>
                    <strong id="confirmPaymentMethod">-</strong>
                </div>
                <div class="confirmation-row">
                    <span>Total Amount:</span>
                    <strong id="confirmTotalAmount">$0.00</strong>
                </div>
            </div>
            
            <button class="confirmation-button" id="confirmationDone">Done</button>
        </div>
    </div>

    <!-- Top Navigation -->
    <div class="top-nav">
        <div class="nav-left">
            <button class="icon-btn" id="searchBtn" title="Search"></button>
            <button class="icon-btn" id="menuBtn" title="Menu"></button>
        </div>
        <div class="nav-right">
            <button class="icon-btn" id="userBtn" title="Account"></button>
            <button class="icon-btn" id="cartBtn" title="Cart">
                
                <span class="counter-badge cart-badge" id="cartCounter">0</span>
            </button>
            <button class="icon-btn" id="favBtn" title="Favorites">
                
                <span class="counter-badge" id="favCounter">0</span>
            </button>
            <button class="icon-btn" id="themeBtn" title="Toggle theme"></button>
        </div>
    </div>

    <!-- Side Menu -->
    <div class="menu-overlay" id="menuOverlay"></div>
    
    <div class="side-menu" id="sideMenu">
        <div class="menu-header">
            <div class="menu-title">ScaleXR Menus</div>
            <div class="menu-subtitle">Select an item to view in AR</div>
        </div>

        <!-- User Section -->
        <div class="user-section" id="userSection">
            <!-- Will be populated by JavaScript -->
        </div>

        <div class="menu-tabs">
            <button class="menu-tab active" id="allTab">All Items</button>
            <button class="menu-tab" id="favTab">Favorites</button>
        </div>

        <div id="allItemsView"></div>

        <div id="favoritesView" class="hidden">
            <div class="empty-state" id="emptyFavorites">
                <div class="empty-state-icon"></div>
                <div class="empty-state-text">No favorites yet!<br>Tap  on items to save them.</div>
            </div>
            <div id="favoritesContent"></div>
        </div>
    </div>

    <!-- Info Card -->
    <div class="info-card minimized" id="infoCard">
        <div class="info-card-content">
            <div class="info-header">
                <div class="info-main">
                    <div class="food-name" id="currentFoodName"> Blue Artifact</div>
                    <div class="food-price" id="currentFoodPrice">$9.99</div>
                </div>
                <div class="info-actions">
                    <button class="info-fav-btn" id="infoFavBtn" title="Toggle favorite"></button>
                    <button class="minimize-btn" id="minimizeBtn" title="Expand"></button>
                </div>
            </div>
            
            <div class="info-details">
                <!-- Quantity Selector -->
                <div class="qty-selector">
                    <span class="qty-label">Quantity</span>
                    <div class="qty-controls">
                        <button class="qty-btn" id="qtyMinus"></button>
                        <span class="qty-display" id="qtyDisplay">1</span>
                        <button class="qty-btn" id="qtyPlus">+</button>
                    </div>
                </div>

                <div class="food-rating" id="ratingSection">
                    <div class="rating-stars" id="ratingStars"></div>
                    <div class="rating-info">
                        <div class="rating-score" id="ratingScore">4.8</div>
                        <div class="rating-count" id="ratingCount">124 reviews</div>
                    </div>
                    <div class="rating-arrow"></div>
                </div>
                
                <div class="food-meta" id="currentFoodMeta">
                    <span> Candle Cafe</span>
                    <span></span>
                    <span>All Items</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Reviews Modal Overlay -->
    <div class="reviews-overlay" id="reviewsOverlay"></div>

    <!-- Reviews Modal -->
    <div class="reviews-modal" id="reviewsModal">
        <div class="reviews-header">
            <div class="reviews-title">Customer Reviews</div>
            <button class="reviews-close" id="reviewsClose"></button>
        </div>
        
        <div id="reviewsContent"></div>
    </div>

    <!-- Cart Modal Overlay -->
    <div class="cart-overlay" id="cartOverlay"></div>

    <!-- Cart Modal -->
    <div class="cart-modal" id="cartModal">
        <div class="cart-header">
            <div class="cart-title"> Your Cart</div>
            <button class="cart-close" id="cartClose"></button>
        </div>
        
        <div class="cart-items-container" id="cartItems">
            <div class="empty-state">
                <div class="empty-state-icon"></div>
                <div class="empty-state-text">Your cart is empty<br>Add items to get started!</div>
            </div>
        </div>

        <div class="cart-summary" id="cartSummary" style="display: none;">
            <div class="cart-summary-row">
                <span class="cart-summary-label">Subtotal:</span>
                <span class="cart-summary-value" id="cartSubtotal">$0.00</span>
            </div>
            <div class="cart-summary-row">
                <span class="cart-summary-label">GST (<span id="gstRate">5</span>%):</span>
                <span class="cart-summary-value" id="cartGST">$0.00</span>
            </div>
            <div class="cart-summary-row cart-total">
                <span class="cart-summary-label">Total:</span>
                <span class="cart-summary-value" id="cartTotal">$0.00</span>
            </div>
        </div>

        <button class="checkout-btn" id="checkoutBtn" disabled>Proceed to Checkout</button>
    </div>

    <!-- Checkout Modal -->
    <div class="checkout-modal" id="checkoutModal">
        <div class="checkout-header">
            <div class="checkout-title"> Checkout</div>
            <button class="cart-close" id="checkoutClose"></button>
        </div>

        <form id="checkoutForm">
            <div class="checkout-section">
                <div class="checkout-section-title">Table Information</div>
                <div class="form-group">
                    <label class="form-label">Table Number *</label>
                    <input type="text" class="form-input" id="tableNumber" placeholder="Enter your table number" required>
                </div>
            </div>

            <div class="checkout-section">
                <div class="checkout-section-title">Payment Method *</div>
                <div class="payment-methods">
                    <div class="payment-method" data-method="cash" data-gst="0.15">
                        <div class="payment-method-icon"></div>
                        <div class="payment-method-name">Cash</div>
                        <div class="payment-method-gst">15% GST</div>
                    </div>
                    <div class="payment-method" data-method="card-machine" data-gst="0.05">
                        <div class="payment-method-icon"></div>
                        <div class="payment-method-name">Card Machine</div>
                        <div class="payment-method-gst">5% GST</div>
                    </div>
                    <div class="payment-method" data-method="card-online" data-gst="0.05">
                        <div class="payment-method-icon"></div>
                        <div class="payment-method-name">Online Card</div>
                        <div class="payment-method-gst">5% GST</div>
                    </div>
                </div>
            </div>

            <div class="checkout-section">
                <div class="checkout-section-title">Order Summary</div>
                <div class="order-summary-mini">
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span id="checkoutSubtotal">$0.00</span>
                    </div>
                    <div class="summary-row">
                        <span>GST (<span id="checkoutGSTRate">5</span>%):</span>
                        <span id="checkoutGST">$0.00</span>
                    </div>
                    <div class="summary-row summary-total">
                        <span>Total:</span>
                        <span id="checkoutTotal">$0.00</span>
                    </div>
                </div>
            </div>

            <button type="submit" class="place-order-btn" id="placeOrderBtn" disabled>Place Order</button>
        </form>
    </div>

    <!-- Help Button - ALWAYS VISIBLE -->
    <button class="help-btn" id="helpBtn" title="Help"></button>

    <!-- AR Viewer -->
    <model-viewer
        id="ar-viewer"
        src="Restaurants/Cheezious/Sandwich.glb"
        ios-src="Restaurants/Cheezious/Sandwich.usdz"
        poster="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23f8f9fa;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23e5e7eb;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect fill='url(%23grad)' width='400' height='400'/%3E%3Ctext x='50%25' y='45%25' dominant-baseline='middle' text-anchor='middle' font-size='80'%3E%3C/text%3E%3Ctext x='50%25' y='65%25' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-size='16' fill='%231a1a1a'%3ELoading...%3C/text%3E%3C/svg%3E"
        alt="3D model"
        ar
        ar-modes="webxr scene-viewer quick-look"
        camera-controls
        camera-target="0m 0m 0m"
        shadow-intensity="1"
        camera-orbit="0deg 75deg auto"
        min-camera-orbit="auto auto 5%"
        max-camera-orbit="auto auto 500%"
        environment-image="neutral"
        exposure="1"
        shadow-softness="1"
        ar-scale="auto"
        ar-placement="floor"
        interaction-prompt="auto"
        interaction-prompt-threshold="0"
        loading="eager"
        reveal="auto">
    </model-viewer>

    <!-- Grid Floor -->
    <div class="grid-floor"></div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading 3D Model...</div>
        <div class="loading-progress">
            <div class="loading-progress-bar" id="loadingProgressBar"></div>
        </div>
    </div>

    <!-- Error Message -->
    <div class="error-message" id="errorMessage">
        <div class="error-icon"></div>
        <div class="error-title" id="errorTitle">Oops!</div>
        <div class="error-text" id="errorText">Something went wrong</div>
        <button class="error-close" id="errorClose">Try Again</button>
    </div>

    <!-- Bottom Action Bar -->
    <div class="bottom-bar">
        <button class="ar-button" id="arButton">
            <span></span>
            <span>View in AR</span>
        </button>
        <button class="ar-button add-to-cart-button" id="addToCartButton">
            <span></span>
            <span>Add to Cart</span>
        </button>
        <button class="action-btn" id="shareBtn" title="Share"></button>
    </div>

    <!-- Share Modal Overlay -->
    <div class="share-overlay" id="shareOverlay"></div>

    <!-- Share Modal -->
    <div class="share-modal" id="shareModal">
        <div class="share-header">Share this item!</div>
        <div class="share-options">
            <div class="share-option" data-platform="whatsapp">
                <div class="share-option-icon"></div>
                <div class="share-option-label">WhatsApp</div>
            </div>
            <div class="share-option" data-platform="copy">
                <div class="share-option-icon"></div>
                <div class="share-option-label">Copy Link</div>
            </div>
            <div class="share-option" data-platform="twitter">
                <div class="share-option-icon"></div>
                <div class="share-option-label">Twitter</div>
            </div>
            <div class="share-option" data-platform="native">
                <div class="share-option-icon"></div>
                <div class="share-option-label">More</div>
            </div>
        </div>
        <button class="share-close" id="shareClose">Close</button>
    </div>

    <script>
        // RESTAURANT DATA WITH CUSTOM LIGHTING
        const RESTAURANTS = [
            {
                id: 'cheezious',
                name: ' Cheezious',
                lighting: {
                    exposure: 1.1,
                    shadowIntensity: 1.0,
                    environmentImage: 'neutral',
                    cameraOrbit: '0deg 75deg auto',
                    theme: 'warm'
                },
                categories: [
                    {
                        id: 'all-items',
                        name: 'All Items',
                        items: [
                            {
                                id: 'sandwich',
                                name: ' Cheese Sandwich',
                                price: 450,
                                emoji: '',
                                rating: 4.6,
                                reviewCount: 89,
                                views60Days: 1234,
                                modelGLB: 'Restaurants/Cheezious/Sandwich.glb',
                                modelUSDZ: 'Restaurants/Cheezious/Sandwich.usdz',
                                reviews: [
                                    { author: 'Ahmed K.', rating: 5, date: '2 days ago', text: 'Best cheese sandwich in town! Fresh ingredients and great value for money.' },
                                    { author: 'Sara M.', rating: 4, date: '1 week ago', text: 'Delicious and cheesy. Would recommend!' }
                                ]
                            }
                        ]
                    }
                ]
            },
            {
                id: 'chinese',
                name: ' Chinese',
                lighting: {
                    exposure: 1.0,
                    shadowIntensity: 0.9,
                    environmentImage: 'legacy',
                    cameraOrbit: '0deg 80deg auto',
                    theme: 'cool'
                },
                categories: [
                    {
                        id: 'all-items',
                        name: 'All Items',
                        items: [
                            {
                                id: 'crab-platter',
                                name: ' Crab Platter',
                                price: 1850,
                                emoji: '',
                                rating: 4.9,
                                reviewCount: 234,
                                views60Days: 3421,
                                modelGLB: 'Restaurants/Chinese/Crab Platter.glb',
                                modelUSDZ: 'Restaurants/Chinese/Crab Platter.usdz',
                                reviews: [
                                    { author: 'Ali R.', rating: 5, date: '1 day ago', text: 'Amazing crab platter! Fresh and perfectly cooked.' },
                                    { author: 'Fatima S.', rating: 5, date: '3 days ago', text: 'Best seafood experience. Highly recommended!' }
                                ]
                            },
                            {
                                id: 'crabs',
                                name: ' Steamed Crabs',
                                price: 1650,
                                emoji: '',
                                rating: 4.8,
                                reviewCount: 198,
                                views60Days: 2876,
                                modelGLB: 'Restaurants/Chinese/Crabs.glb',
                                modelUSDZ: 'Restaurants/Chinese/Crabs.usdz',
                                reviews: []
                            },
                            {
                                id: 'fish-cut',
                                name: ' Fish Cut Special',
                                price: 1200,
                                emoji: '',
                                rating: 4.7,
                                reviewCount: 176,
                                views60Days: 2345,
                                modelGLB: 'Restaurants/Chinese/Fish cut.glb',
                                modelUSDZ: 'Restaurants/Chinese/Fish cut.usdz',
                                reviews: []
                            },
                            {
                                id: 'fish-soup',
                                name: ' Hot Fish Soup',
                                price: 950,
                                emoji: '',
                                rating: 4.6,
                                reviewCount: 143,
                                views60Days: 1987,
                                modelGLB: 'Restaurants/Chinese/Fish Soup.glb',
                                modelUSDZ: 'Restaurants/Chinese/Fish Soup.usdz',
                                reviews: []
                            },
                            {
                                id: 'fried-fish',
                                name: ' Crispy Fried Fish',
                                price: 1100,
                                emoji: '',
                                rating: 4.8,
                                reviewCount: 189,
                                views60Days: 2654,
                                modelGLB: 'Restaurants/Chinese/Fried Fish.glb',
                                modelUSDZ: 'Restaurants/Chinese/Fried Fish.usdz',
                                reviews: []
                            },
                            {
                                id: 'prawns',
                                name: ' Jumbo Prawns',
                                price: 1550,
                                emoji: '',
                                rating: 4.9,
                                reviewCount: 267,
                                views60Days: 3198,
                                modelGLB: 'Restaurants/Chinese/Prawns.glb',
                                modelUSDZ: 'Restaurants/Chinese/Prawns.usdz',
                                reviews: []
                            },
                            {
                                id: 'ramen',
                                name: ' Special Ramen',
                                price: 850,
                                emoji: '',
                                rating: 4.7,
                                reviewCount: 198,
                                views60Days: 2876,
                                modelGLB: 'Restaurants/Chinese/Ramen.glb',
                                modelUSDZ: 'Restaurants/Chinese/Ramen.usdz',
                                reviews: []
                            },
                            {
                                id: 'shells',
                                name: ' Fresh Shells',
                                price: 1350,
                                emoji: '',
                                rating: 4.6,
                                reviewCount: 145,
                                views60Days: 2123,
                                modelGLB: 'Restaurants/Chinese/Shells.glb',
                                modelUSDZ: 'Restaurants/Chinese/Shells.usdz',
                                reviews: []
                            },
                            {
                                id: 'shrimp-soup',
                                name: ' Shrimp Soup',
                                price: 900,
                                emoji: '',
                                rating: 4.7,
                                reviewCount: 156,
                                views60Days: 2234,
                                modelGLB: 'Restaurants/Chinese/Shrimp Soup.glb',
                                modelUSDZ: 'Restaurants/Chinese/Shrimp Soup.usdz',
                                reviews: []
                            },
                            {
                                id: 'shrimps',
                                name: ' Grilled Shrimps',
                                price: 1450,
                                emoji: '',
                                rating: 4.8,
                                reviewCount: 223,
                                views60Days: 2987,
                                modelGLB: 'Restaurants/Chinese/Shrimps.glb',
                                modelUSDZ: 'Restaurants/Chinese/Shrimps.usdz',
                                reviews: []
                            }
                        ]
                    }
                ]
            },
            {
                id: 'fries-project',
                name: ' Fries Project',
                lighting: {
                    exposure: 1.1,
                    shadowIntensity: 1.0,
                    environmentImage: 'neutral',
                    cameraOrbit: '0deg 75deg auto',
                    theme: 'warm'
                },
                categories: [
                    {
                        id: 'all-items',
                        name: 'All Items',
                        items: [
                            {
                                id: 'masala-fries',
                                name: ' Masala Fries',
                                price: 350,
                                emoji: '',
                                rating: 4.5,
                                reviewCount: 178,
                                views60Days: 2456,
                                modelGLB: 'Restaurants/Fries Project/Masala Fries.glb',
                                modelUSDZ: 'Restaurants/Fries Project/Masala Fries.usdz',
                                reviews: [
                                    { author: 'Hamza A.', rating: 5, date: '1 day ago', text: 'Perfect spice level! Love these masala fries.' },
                                    { author: 'Ayesha K.', rating: 4, date: '5 days ago', text: 'Crispy and tasty. Good portion size.' }
                                ]
                            },
                            {
                                id: 'wrap',
                                name: ' Chicken Wrap',
                                price: 450,
                                emoji: '',
                                rating: 4.7,
                                reviewCount: 156,
                                views60Days: 2198,
                                modelGLB: 'Restaurants/Fries Project/Wrap.glb',
                                modelUSDZ: 'Restaurants/Fries Project/Wrap.usdz',
                                reviews: []
                            }
                        ]
                    }
                ]
            },
            {
                id: 'mc-donalds',
                name: ' McDonald\'s',
                lighting: {
                    exposure: 1.2,
                    shadowIntensity: 1.1,
                    environmentImage: 'neutral',
                    cameraOrbit: '0deg 75deg auto',
                    theme: 'bright'
                },
                categories: [
                    {
                        id: 'all-items',
                        name: 'All Items',
                        items: [
                            {
                                id: 'mc-classic-burger',
                                name: ' MC Classic Burger',
                                price: 550,
                                emoji: '',
                                rating: 4.7,
                                reviewCount: 467,
                                views60Days: 5432,
                                modelGLB: 'Restaurants/Mc Donalds/MC Classic Burger.glb',
                                modelUSDZ: 'Restaurants/Mc Donalds/MC Classic Burger.usdz',
                                reviews: [
                                    { author: 'Usman M.', rating: 5, date: '1 day ago', text: 'Classic McDonald\'s taste. Always satisfying!' },
                                    { author: 'Zara F.', rating: 4, date: '2 days ago', text: 'Good burger, fresh ingredients.' }
                                ]
                            },
                            {
                                id: 'mc-deal-1',
                                name: ' MC Deal 1',
                                price: 850,
                                emoji: '',
                                rating: 4.8,
                                reviewCount: 389,
                                views60Days: 4876,
                                modelGLB: 'Restaurants/Mc Donalds/MC Deal 1.glb',
                                modelUSDZ: 'Restaurants/Mc Donalds/MC Deal 1.usdz',
                                reviews: []
                            },
                            {
                                id: 'mc-deal-2',
                                name: ' MC Deal 2',
                                price: 1050,
                                emoji: '',
                                rating: 4.9,
                                reviewCount: 423,
                                views60Days: 5123,
                                modelGLB: 'Restaurants/Mc Donalds/MC Deal 2.glb',
                                modelUSDZ: 'Restaurants/Mc Donalds/MC Deal 2.usdz',
                                reviews: []
                            },
                            {
                                id: 'mc-deal-3',
                                name: ' MC Deal 3',
                                price: 1250,
                                emoji: '',
                                rating: 4.8,
                                reviewCount: 378,
                                views60Days: 4567,
                                modelGLB: 'Restaurants/Mc Donalds/MC Deal 3.glb',
                                modelUSDZ: 'Restaurants/Mc Donalds/MC Deal 3.usdz',
                                reviews: []
                            }
                        ]
                    }
                ]
            },
            {
                id: 'perk-cafe',
                name: ' Perk Cafe',
                lighting: {
                    exposure: 1.1,
                    shadowIntensity: 0.9,
                    environmentImage: 'legacy',
                    cameraOrbit: '0deg 80deg auto',
                    theme: 'cozy'
                },
                categories: [
                    {
                        id: 'all-items',
                        name: 'All Items',
                        items: [
                            {
                                id: 'chicken-tikka-sandwich',
                                name: ' Chicken Tikka Sandwich',
                                price: 550,
                                emoji: '',
                                rating: 4.8,
                                reviewCount: 234,
                                views60Days: 3456,
                                modelGLB: 'Restaurants/Perk Cafe/Chicken Tikka Sandwich.glb',
                                modelUSDZ: 'Restaurants/Perk Cafe/Chicken Tikka Sandwich.usdz',
                                reviews: [
                                    { author: 'Bilal H.', rating: 5, date: '1 day ago', text: 'Best tikka sandwich ever! Perfectly spiced.' },
                                    { author: 'Maryam K.', rating: 5, date: '3 days ago', text: 'Amazing flavor and generous portion.' }
                                ]
                            },
                            {
                                id: 'chocolate-cupcake',
                                name: ' Chocolate Cupcake',
                                price: 250,
                                emoji: '',
                                rating: 4.7,
                                reviewCount: 189,
                                views60Days: 2876,
                                modelGLB: 'Restaurants/Perk Cafe/Chocolate Cupcake.glb',
                                modelUSDZ: 'Restaurants/Perk Cafe/Chocolate Cupcake.usdz',
                                reviews: []
                            },
                            {
                                id: 'coffee-cup',
                                name: ' Premium Coffee',
                                price: 350,
                                emoji: '',
                                rating: 4.9,
                                reviewCount: 456,
                                views60Days: 5234,
                                modelGLB: 'Restaurants/Perk Cafe/Coffee Cup.glb',
                                modelUSDZ: 'Restaurants/Perk Cafe/Coffee Cup.usdz',
                                reviews: []
                            },
                            {
                                id: 'banana-bread',
                                name: ' Sliced Banana Bread',
                                price: 400,
                                emoji: '',
                                rating: 4.6,
                                reviewCount: 167,
                                views60Days: 2345,
                                modelGLB: 'Restaurants/Perk Cafe/Sliced Banana Bread Loaf.glb',
                                modelUSDZ: 'Restaurants/Perk Cafe/Sliced Banana Bread Loaf.usdz',
                                reviews: []
                            }
                        ]
                    }
                ]
            },
            {
                id: 'pizza-hut',
                name: ' Pizza Hut',
                lighting: {
                    exposure: 1.2,
                    shadowIntensity: 1.0,
                    environmentImage: 'neutral',
                    cameraOrbit: '0deg 75deg auto',
                    theme: 'warm'
                },
                categories: [
                    {
                        id: 'all-items',
                        name: 'All Items',
                        items: [
                            {
                                id: 'fajita-pizza',
                                name: ' Fajita Pizza',
                                price: 1650,
                                emoji: '',
                                rating: 4.9,
                                reviewCount: 567,
                                views60Days: 6543,
                                modelGLB: 'Restaurants/Pizza Hut/Fajita Pizza.glb',
                                modelUSDZ: 'Restaurants/Pizza Hut/Fajita Pizza.usdz',
                                reviews: [
                                    { author: 'Asad M.', rating: 5, date: '1 day ago', text: 'Best fajita pizza in Pakistan! Loaded with toppings.' },
                                    { author: 'Hina A.', rating: 5, date: '2 days ago', text: 'Family favorite. We order this every week!' }
                                ]
                            },
                            {
                                id: 'pepperoni-pizza',
                                name: ' Pepperoni Pizza',
                                price: 1550,
                                emoji: '',
                                rating: 4.8,
                                reviewCount: 489,
                                views60Days: 5876,
                                modelGLB: 'Restaurants/Pizza Hut/Peperoni Pizza.glb',
                                modelUSDZ: 'Restaurants/Pizza Hut/Peperoni Pizza.usdz',
                                reviews: []
                            },
                            {
                                id: 'tikka-pizza',
                                name: ' Tikka Pizza',
                                price: 1700,
                                emoji: '',
                                rating: 4.9,
                                reviewCount: 534,
                                views60Days: 6234,
                                modelGLB: 'Restaurants/Pizza Hut/Tikka Pizza.glb',
                                modelUSDZ: 'Restaurants/Pizza Hut/Tikka Pizza.usdz',
                                reviews: []
                            }
                        ]
                    }
                ]
            },
            {
                id: 'steak-house',
                name: ' Steak House',
                lighting: {
                    exposure: 1.0,
                    shadowIntensity: 1.2,
                    environmentImage: 'neutral',
                    cameraOrbit: '0deg 70deg auto',
                    theme: 'elegant'
                },
                categories: [
                    {
                        id: 'all-items',
                        name: 'All Items',
                        items: [
                            {
                                id: 'classic-beef-burger',
                                name: ' Classic Beef Burger',
                                price: 750,
                                emoji: '',
                                rating: 4.8,
                                reviewCount: 345,
                                views60Days: 4321,
                                modelGLB: 'Restaurants/Steak House/Classic Beef Burger.glb',
                                modelUSDZ: 'Restaurants/Steak House/Classic Beef Burger.usdz',
                                reviews: [
                                    { author: 'Kamran S.', rating: 5, date: '2 days ago', text: 'Juicy and perfectly cooked. Best beef burger!' },
                                    { author: 'Nida R.', rating: 4, date: '1 week ago', text: 'Great taste and quality meat.' }
                                ]
                            },
                            {
                                id: 'steak',
                                name: ' Premium Steak',
                                price: 1950,
                                emoji: '',
                                rating: 4.9,
                                reviewCount: 278,
                                views60Days: 3987,
                                modelGLB: 'Restaurants/Steak House/Steak.glb',
                                modelUSDZ: 'Restaurants/Steak House/Steak.usdz',
                                reviews: []
                            }
                        ]
                    }
                ]
            },
            {
                id: 'subway',
                name: ' Subway',
                lighting: {
                    exposure: 1.1,
                    shadowIntensity: 1.0,
                    environmentImage: 'neutral',
                    cameraOrbit: '0deg 75deg auto',
                    theme: 'fresh'
                },
                categories: [
                    {
                        id: 'all-items',
                        name: 'All Items',
                        items: [
                            {
                                id: 'subway-pepperoni',
                                name: ' Subway Pepperoni',
                                price: 650,
                                emoji: '',
                                rating: 4.7,
                                reviewCount: 389,
                                views60Days: 4876,
                                modelGLB: 'Restaurants/Subway/Subway Peperoni.glb',
                                modelUSDZ: 'Restaurants/Subway/Subway Peperoni.usdz',
                                reviews: [
                                    { author: 'Faisal K.', rating: 5, date: '1 day ago', text: 'Fresh ingredients and tasty pepperoni. Love it!' },
                                    { author: 'Sana M.', rating: 4, date: '4 days ago', text: 'Good sub, always consistent quality.' }
                                ]
                            }
                        ]
                    }
                ]
            }
        ];

        // GLOBAL STATE
        let currentItem = null;
        let currentRestaurant = null;
        let currentQuantity = 1;
        let favorites = [];
        let cart = [];
        let currentUser = null;
        let selectedPaymentMethod = null;
        let selectedPaymentGST = 0;
        let expandedRestaurants = [];
        let isIOS = false;
        let isInfoMinimized = true; // START MINIMIZED

        // DOM ELEMENTS
        const viewer = document.querySelector('model-viewer');
        const toast = document.getElementById('toast');
        const toastIcon = document.getElementById('toastIcon');
        const toastMessage = document.getElementById('toastMessage');
        const welcomeOverlay = document.getElementById('welcomeOverlay');
        const welcomeButton = document.getElementById('welcomeButton');
        const tutorialOverlay = document.getElementById('tutorialOverlay');
        const tutorialClose = document.getElementById('tutorialClose');
        const helpBtn = document.getElementById('helpBtn');
        const authOverlay = document.getElementById('authOverlay');
        const authCloseBtn = document.getElementById('authCloseBtn');
        const loginTab = document.getElementById('loginTab');
        const signupTab = document.getElementById('signupTab');
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        const userBtn = document.getElementById('userBtn');
        const menuBtn = document.getElementById('menuBtn');
        const cartBtn = document.getElementById('cartBtn');
        const favBtn = document.getElementById('favBtn');
        const sideMenu = document.getElementById('sideMenu');
        const menuOverlay = document.getElementById('menuOverlay');
        const themeBtn = document.getElementById('themeBtn');
        const infoCard = document.getElementById('infoCard');
        const minimizeBtn = document.getElementById('minimizeBtn');
        const infoFavBtn = document.getElementById('infoFavBtn');
        const qtyMinus = document.getElementById('qtyMinus');
        const qtyPlus = document.getElementById('qtyPlus');
        const qtyDisplay = document.getElementById('qtyDisplay');
        const ratingSection = document.getElementById('ratingSection');
        const reviewsOverlay = document.getElementById('reviewsOverlay');
        const reviewsModal = document.getElementById('reviewsModal');
        const reviewsClose = document.getElementById('reviewsClose');
        const reviewsContent = document.getElementById('reviewsContent');
        const cartOverlay = document.getElementById('cartOverlay');
        const cartModal = document.getElementById('cartModal');
        const cartClose = document.getElementById('cartClose');
        const cartItems = document.getElementById('cartItems');
        const cartSummary = document.getElementById('cartSummary');
        const cartCounter = document.getElementById('cartCounter');
        const favCounter = document.getElementById('favCounter');
        const checkoutBtn = document.getElementById('checkoutBtn');
        const checkoutModal = document.getElementById('checkoutModal');
        const checkoutClose = document.getElementById('checkoutClose');
        const checkoutForm = document.getElementById('checkoutForm');
        const tableNumber = document.getElementById('tableNumber');
        const placeOrderBtn = document.getElementById('placeOrderBtn');
        const orderConfirmationOverlay = document.getElementById('orderConfirmationOverlay');
        const confirmationDone = document.getElementById('confirmationDone');
        const arButton = document.getElementById('arButton');
        const addToCartButton = document.getElementById('addToCartButton');
        const shareBtn = document.getElementById('shareBtn');
        const shareModal = document.getElementById('shareModal');
        const shareClose = document.getElementById('shareClose');
        const shareOverlay = document.getElementById('shareOverlay');
        const allTab = document.getElementById('allTab');
        const favTab = document.getElementById('favTab');
        const allItemsView = document.getElementById('allItemsView');
        const favoritesView = document.getElementById('favoritesView');
        const searchBtn = document.getElementById('searchBtn');
        const searchContainer = document.getElementById('searchContainer');
        const searchBar = document.getElementById('searchBar');
        const searchClear = document.getElementById('searchClear');
        const searchResults = document.getElementById('searchResults');

        // UTILITY FUNCTIONS
        function showToast(message, type = 'success') {
            toastMessage.textContent = message;
            toast.className = 'toast show ' + type;
            toastIcon.textContent = type === 'success' ? '' : '';
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function detectIOS() {
            isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent);
            return isIOS;
        }

        function loadFromStorage() {
            const savedFavorites = localStorage.getItem('ar-menu-favorites');
            if (savedFavorites) favorites = JSON.parse(savedFavorites);
            
            const savedCart = localStorage.getItem('ar-menu-cart');
            if (savedCart) cart = JSON.parse(savedCart);
            
            const savedUser = localStorage.getItem('ar-menu-user');
            if (savedUser) currentUser = JSON.parse(savedUser);
            
            updateCounters();
        }

        function saveToStorage() {
            localStorage.setItem('ar-menu-favorites', JSON.stringify(favorites));
            localStorage.setItem('ar-menu-cart', JSON.stringify(cart));
            if (currentUser) {
                localStorage.setItem('ar-menu-user', JSON.stringify(currentUser));
            }
        }

        function updateCounters() {
            if (cart.length > 0) {
                const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
                cartCounter.textContent = totalItems;
                cartCounter.classList.add('show');
            } else {
                cartCounter.classList.remove('show');
            }

            if (favorites.length > 0) {
                favCounter.textContent = favorites.length;
                favCounter.classList.add('show');
            } else {
                favCounter.classList.remove('show');
            }
        }

        // CART FUNCTIONS
        function addToCart(item, quantity = 1) {
            const existingItem = cart.find(i => i.id === item.id);
            
            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                cart.push({
                    id: item.id,
                    name: item.name,
                    price: item.price,
                    emoji: item.emoji,
                    quantity: quantity,
                    restaurantId: currentRestaurant.id
                });
            }
            
            saveToStorage();
            updateCounters();
            renderCart();
            renderAllItems();
            renderFavorites();
            showToast(`${item.emoji} ${item.name} added to cart!`, 'success');
        }

        function updateCartQuantity(itemId, change) {
            const item = cart.find(i => i.id === itemId);
            if (!item) return;
            
            item.quantity += change;
            
            if (item.quantity <= 0) {
                removeFromCart(itemId);
                return;
            }
            
            saveToStorage();
            updateCounters();
            renderCart();
            renderAllItems();
            renderFavorites();
        }

        function removeFromCart(itemId) {
            cart = cart.filter(i => i.id !== itemId);
            saveToStorage();
            updateCounters();
            renderCart();
            renderAllItems();
            renderFavorites();
            showToast('Item removed from cart', 'success');
        }

        function getCartItemQuantity(itemId) {
            const item = cart.find(i => i.id === itemId);
            return item ? item.quantity : 0;
        }

        function calculateCartTotals() {
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const gstRate = selectedPaymentGST || 0.15; // Default 15% if not selected
            const gst = subtotal * gstRate;
            const total = subtotal + gst;
            
            return { subtotal, gst, gstRate: gstRate * 100, total };
        }

        function renderCart() {
            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon"></div>
                        <div class="empty-state-text">Your cart is empty<br>Add items to get started!</div>
                    </div>
                `;
                cartSummary.style.display = 'none';
                checkoutBtn.disabled = true;
                return;
            }

            cartItems.innerHTML = cart.map(item => `
                <div class="cart-item">
                    <div class="cart-item-icon">${item.emoji}</div>
                    <div class="cart-item-info">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-price">${formatPrice(item.price)} each</div>
                    </div>
                    <div class="cart-item-controls">
                        <button class="cart-qty-btn" onclick="updateCartQuantity('${item.id}', -1)"></button>
                        <span class="cart-qty-display">${item.quantity}</span>
                        <button class="cart-qty-btn" onclick="updateCartQuantity('${item.id}', 1)">+</button>
                        <button class="cart-remove-btn" onclick="removeFromCart('${item.id}')"></button>
                    </div>
                </div>
            `).join('');

            const { subtotal, gst, gstRate, total } = calculateCartTotals();

            document.getElementById('cartSubtotal').textContent = formatPrice(subtotal);
            document.getElementById('cartGST').textContent = formatPrice(gst);
            document.getElementById('gstRate').textContent = gstRate;
            document.getElementById('cartTotal').textContent = formatPrice(total);

            cartSummary.style.display = 'block';
            checkoutBtn.disabled = false;
        }

        function openCart() {
            closeSearch();
            renderCart();
            cartModal.classList.add('show');
            cartOverlay.classList.add('show');
        }

        function closeCart() {
            cartModal.classList.remove('show');
            cartOverlay.classList.remove('show');
        }

        // CHECKOUT FUNCTIONS
        function openCheckout() {
            if (cart.length === 0) return;
            
            closeCart();
            
            const { subtotal, gst, gstRate, total } = calculateCartTotals();
            document.getElementById('checkoutSubtotal').textContent = formatPrice(subtotal);
            document.getElementById('checkoutGST').textContent = formatPrice(gst);
            document.getElementById('checkoutGSTRate').textContent = gstRate;
            document.getElementById('checkoutTotal').textContent = formatPrice(total);
            
            checkoutModal.classList.add('show');
            cartOverlay.classList.add('show');
        }

        function closeCheckout() {
            checkoutModal.classList.remove('show');
            cartOverlay.classList.remove('show');
        }

        function placeOrder(event) {
            event.preventDefault();
            
            if (!selectedPaymentMethod) {
                showToast('Please select a payment method', 'error');
                return;
            }
            
            const table = tableNumber.value.trim();
            if (!table) {
                showToast('Please enter your table number', 'error');
                return;
            }

            const orderNumber = Math.floor(1000 + Math.random() * 9000);
            const { total } = calculateCartTotals();
            
            // Get payment method display name
            let paymentDisplay = '';
            switch(selectedPaymentMethod) {
                case 'cash':
                    paymentDisplay = 'Cash (15% GST)';
                    break;
                case 'card-machine':
                    paymentDisplay = 'Card Machine (5% GST)';
                    break;
                case 'card-online':
                    paymentDisplay = 'Online Card (5% GST)';
                    break;
            }
            
            document.getElementById('orderNumber').textContent = `#${orderNumber}`;
            document.getElementById('confirmTableNumber').textContent = table;
            document.getElementById('confirmPaymentMethod').textContent = paymentDisplay;
            document.getElementById('confirmTotalAmount').textContent = formatPrice(total);
            
            closeCheckout();
            orderConfirmationOverlay.classList.add('show');
            
            // Clear cart and form
            cart = [];
            saveToStorage();
            updateCounters();
            tableNumber.value = '';
            selectedPaymentMethod = null;
            selectedPaymentGST = 0;
            document.querySelectorAll('.payment-method').forEach(el => el.classList.remove('active'));
        }

        // USER FUNCTIONS
        function updateProfileButton() {
            const userBtn = document.getElementById('userBtn');
            if (currentUser) {
                // Show user's first initial instead of default icon
                userBtn.textContent = currentUser.name.charAt(0).toUpperCase();
                userBtn.style.fontWeight = '700';
                userBtn.style.fontSize = '18px';
            } else {
                // Show default icon
                userBtn.textContent = '';
                userBtn.style.fontWeight = '';
                userBtn.style.fontSize = '';
            }
        }

        function renderUserSection() {
            const userSection = document.getElementById('userSection');

            if (currentUser) {
                userSection.innerHTML = `
                    <div class="user-avatar">${currentUser.name.charAt(0).toUpperCase()}</div>
                    <div class="user-info">
                        <div class="user-name">${currentUser.name}</div>
                        <div class="user-email">${currentUser.email}</div>
                    </div>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                `;
            } else {
                userSection.innerHTML = `
                    <div class="user-avatar"></div>
                    <div class="login-prompt">Login to save favorites</div>
                    <button class="login-btn-small" onclick="openAuth()">Login</button>
                `;
            }

            // Sync the profile button
            updateProfileButton();
        }

        function openAuth() {
            authOverlay.classList.add('show');
        }

        function closeAuth() {
            authOverlay.classList.remove('show');
        }

        function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Simple demo login - in real app, validate against backend
            const savedUser = localStorage.getItem(`user_${email}`);
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showToast(`Welcome back, ${currentUser.name}!`, 'success');
            } else {
                showToast('User not found. Please sign up.', 'error');
                return;
            }
            
            saveToStorage();
            renderUserSection();
            closeAuth();
            loginForm.reset();
        }

        function handleSignup(event) {
            event.preventDefault();
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            
            currentUser = {
                id: Date.now().toString(),
                name: name,
                email: email,
                favorites: [],
                orderHistory: []
            };
            
            localStorage.setItem(`user_${email}`, JSON.stringify(currentUser));
            saveToStorage();
            renderUserSection();
            closeAuth();
            signupForm.reset();
            showToast(`Account created! Welcome, ${name}!`, 'success');
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('ar-menu-user');
            renderUserSection();
            showToast('Logged out successfully', 'success');
        }

        // MENU & ITEMS FUNCTIONS
        function generateStars(rating) {
            const fullStars = Math.floor(rating);
            let stars = '';
            for (let i = 0; i < fullStars; i++) stars += '';
            return stars;
        }

        function toggleFavorite(itemId) {
            const index = favorites.indexOf(itemId);
            if (index > -1) {
                favorites.splice(index, 1);
            } else {
                favorites.push(itemId);
            }
            saveToStorage();
            updateCounters();
            updateInfoFavoriteButton();
            renderAllItems();
            renderFavorites();
        }

        function renderAllItems() {
            allItemsView.innerHTML = '';
            
            RESTAURANTS.forEach(restaurant => {
                const restaurantDiv = document.createElement('div');
                restaurantDiv.className = 'restaurant-section';
                
                const headerDiv = document.createElement('div');
                headerDiv.className = 'restaurant-header';
                if (expandedRestaurants.includes(restaurant.id)) {
                    headerDiv.classList.add('expanded');
                }
                
                headerDiv.innerHTML = `
                    <span class="restaurant-icon">${restaurant.name.split(' ')[0]}</span>
                    <span class="restaurant-name">${restaurant.name.substring(2)}</span>
                    <span class="expand-icon"></span>
                `;
                
                headerDiv.addEventListener('click', () => toggleRestaurant(restaurant.id));
                restaurantDiv.appendChild(headerDiv);
                
                restaurant.categories.forEach(category => {
                    const categoryDiv = document.createElement('div');
                    categoryDiv.className = 'category-section';
                    if (expandedRestaurants.includes(restaurant.id)) {
                        categoryDiv.classList.add('show');
                    }
                    
                    const categoryHeader = document.createElement('div');
                    categoryHeader.className = 'category-header';
                    categoryHeader.textContent = category.name;
                    categoryDiv.appendChild(categoryHeader);
                    
                    category.items.forEach(item => {
                        const itemDiv = createMenuItem(item, restaurant, category);
                        categoryDiv.appendChild(itemDiv);
                    });
                    
                    restaurantDiv.appendChild(categoryDiv);
                });
                
                allItemsView.appendChild(restaurantDiv);
            });
        }

        function createMenuItem(item, restaurant, category) {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'menu-item';
            
            if (currentItem && currentItem.id === item.id) {
                itemDiv.classList.add('active');
            }
            
            const cartQty = getCartItemQuantity(item.id);
            if (cartQty > 0) {
                itemDiv.classList.add('in-cart');
            }
            
            itemDiv.innerHTML = `
                <div class="menu-item-content">
                    <div class="menu-item-header">
                        <div class="menu-item-name">${item.name}</div>
                        <div class="menu-item-rating">${generateStars(item.rating)} ${item.rating}</div>
                    </div>
                    <div class="menu-item-details">
                        <div class="menu-item-price">$${item.price.toFixed(2)}</div>
                        <div class="menu-item-views"> ${item.views60Days.toLocaleString()}</div>
                    </div>
                </div>
                <div class="menu-item-actions">
                    <button class="item-fav-btn" aria-label="Toggle favorite">
                        ${favorites.includes(item.id) ? '' : ''}
                    </button>
                    ${cartQty > 0 ? `<span class="cart-qty-badge">${cartQty}</span>` : `<button class="quick-add-btn">+ Add</button>`}
                </div>
            `;
            
            itemDiv.querySelector('.menu-item-content').addEventListener('click', () => {
                selectItem(item, restaurant, category);
                closeMenu();
            });
            
            const favBtn = itemDiv.querySelector('.item-fav-btn');
            favBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                toggleFavorite(item.id);
            });
            
            const quickAddBtn = itemDiv.querySelector('.quick-add-btn');
            if (quickAddBtn) {
                quickAddBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    addToCart(item, 1);
                });
            }
            
            return itemDiv;
        }

        function toggleRestaurant(restaurantId) {
            const index = expandedRestaurants.indexOf(restaurantId);
            if (index > -1) {
                expandedRestaurants.splice(index, 1);
            } else {
                expandedRestaurants.push(restaurantId);
            }
            renderAllItems();
        }

        function renderFavorites() {
            const favoritesContent = document.getElementById('favoritesContent');
            const emptyFavorites = document.getElementById('emptyFavorites');
            
            if (favorites.length === 0) {
                emptyFavorites.classList.remove('hidden');
                favoritesContent.innerHTML = '';
                return;
            }
            
            emptyFavorites.classList.add('hidden');
            favoritesContent.innerHTML = '';
            
            RESTAURANTS.forEach(restaurant => {
                let restaurantHasFavorites = false;
                const restaurantDiv = document.createElement('div');
                restaurantDiv.className = 'restaurant-section';
                
                const headerDiv = document.createElement('div');
                headerDiv.className = 'restaurant-header expanded';
                headerDiv.innerHTML = `
                    <span class="restaurant-icon">${restaurant.name.split(' ')[0]}</span>
                    <span class="restaurant-name">${restaurant.name.substring(2)}</span>
                `;
                
                restaurant.categories.forEach(category => {
                    const favoriteItems = category.items.filter(item => favorites.includes(item.id));
                    
                    if (favoriteItems.length > 0) {
                        restaurantHasFavorites = true;
                        
                        const categoryDiv = document.createElement('div');
                        categoryDiv.className = 'category-section show';
                        
                        const categoryHeader = document.createElement('div');
                        categoryHeader.className = 'category-header';
                        categoryHeader.textContent = category.name;
                        categoryDiv.appendChild(categoryHeader);
                        
                        favoriteItems.forEach(item => {
                            const itemDiv = createMenuItem(item, restaurant, category);
                            categoryDiv.appendChild(itemDiv);
                        });
                        
                        restaurantDiv.appendChild(categoryDiv);
                    }
                });
                
                if (restaurantHasFavorites) {
                    restaurantDiv.insertBefore(headerDiv, restaurantDiv.firstChild);
                    favoritesContent.appendChild(restaurantDiv);
                }
            });
        }

        // ITEM SELECTION & AR
        function applyRestaurantLighting(restaurant) {
            const lighting = restaurant.lighting;
            viewer.setAttribute('exposure', lighting.exposure);
            viewer.setAttribute('shadow-intensity', lighting.shadowIntensity);
            viewer.setAttribute('environment-image', lighting.environmentImage);
            viewer.setAttribute('camera-orbit', lighting.cameraOrbit);
        }

        function selectItem(item, restaurant, category) {
            currentItem = item;
            currentRestaurant = restaurant;
            currentQuantity = 1;
            
            document.getElementById('currentFoodName').textContent = item.name;
            document.getElementById('currentFoodPrice').textContent = formatPrice(item.price);
            document.getElementById('currentFoodMeta').innerHTML = `
                <span> ${restaurant.name.substring(2)}</span>
                <span></span>
                <span>${category.name}</span>
            `;
            
            document.getElementById('ratingStars').textContent = generateStars(item.rating);
            document.getElementById('ratingScore').textContent = item.rating.toFixed(1);
            document.getElementById('ratingCount').textContent = `${item.reviewCount} reviews`;
            
            document.getElementById('qtyDisplay').textContent = currentQuantity;
            
            // Update favorite button
            updateInfoFavoriteButton();
            
            // Maintain minimize state (don't change it)
            if (isInfoMinimized) {
                infoCard.classList.add('minimized');
                minimizeBtn.textContent = '';
                minimizeBtn.title = 'Expand';
            } else {
                infoCard.classList.remove('minimized');
                minimizeBtn.textContent = '';
                minimizeBtn.title = 'Minimize';
            }
            
            // Show loading
            document.getElementById('loadingOverlay').classList.add('show');
            document.getElementById('loadingProgressBar').style.width = '0%';
            
            // Clear any existing timeout
            if (window.loadingTimeout) {
                clearTimeout(window.loadingTimeout);
            }
            
            // Set timeout for slow loading models (30 seconds)
            window.loadingTimeout = setTimeout(() => {
                document.getElementById('loadingOverlay').classList.remove('show');
                showToast('Model taking too long to load. Check your connection.', 'error');
            }, 30000);
            
            // Properly encode file paths (handle spaces and special characters)
            const encodedGLB = item.modelGLB;
            const encodedUSDZ = item.modelUSDZ.split('/').map(part => encodeURIComponent(part)).join('/');
            
            // Set model sources WITHOUT cache busting for faster loads
            viewer.src = encodedGLB;
            viewer.iosSrc = encodedUSDZ;
            
            // FIXED: iOS AR placement settings
            viewer.setAttribute('ar-scale', 'auto');
            viewer.setAttribute('ar-placement', 'floor');
            viewer.setAttribute('camera-target', '0m 0m 0m');
            viewer.setAttribute('interaction-prompt', 'auto');
            viewer.setAttribute('interaction-prompt-threshold', '0');
            viewer.setAttribute('loading', 'eager');
            
            // Apply restaurant lighting
            applyRestaurantLighting(restaurant);
            
            renderAllItems();
            renderFavorites();
        }

        function updateQuantity(change) {
            currentQuantity = Math.max(1, currentQuantity + change);
            document.getElementById('qtyDisplay').textContent = currentQuantity;
        }

        function showReviews() {
            if (!currentItem || !currentItem.reviews) return;
            
            reviewsContent.innerHTML = '';
            
            currentItem.reviews.forEach(review => {
                const reviewDiv = document.createElement('div');
                reviewDiv.className = 'review-item';
                reviewDiv.innerHTML = `
                    <div class="review-header">
                        <span class="review-author">${review.author}</span>
                        <span class="review-stars">${generateStars(review.rating)}</span>
                    </div>
                    <div class="review-date">${review.date}</div>
                    <div class="review-text">${review.text}</div>
                `;
                reviewsContent.appendChild(reviewDiv);
            });
            // Ensure all functions and event listeners are properly closed
            
            reviewsModal.classList.add('show');
            reviewsOverlay.classList.add('show');
        }

        function closeReviews() {
            reviewsModal.classList.remove('show');
            reviewsOverlay.classList.remove('show');
        }

        // MENU CONTROLS
        function openMenu() {
            closeReviews();
            closeCart();
            closeSearch();
            sideMenu.classList.add('open');
            menuOverlay.classList.add('show');
        }

        function closeMenu() {
            sideMenu.classList.remove('open');
            menuOverlay.classList.remove('show');
        }

        function showAllItems() {
            allTab.classList.add('active');
            favTab.classList.remove('active');
            allItemsView.classList.remove('hidden');
            favoritesView.classList.add('hidden');
        }

        function showFavorites() {
            favTab.classList.add('active');
            allTab.classList.remove('active');
            favoritesView.classList.remove('hidden');
            allItemsView.classList.add('hidden');
        }

        function toggleTheme() {
            const body = document.body;
            
            if (body.classList.contains('light-theme')) {
                body.classList.remove('light-theme');
                body.classList.add('dark-theme');
                themeBtn.textContent = '';
                localStorage.setItem('ar-menu-theme', 'dark');
            } else {
                body.classList.remove('dark-theme');
                body.classList.add('light-theme');
                themeBtn.textContent = '';
                localStorage.setItem('ar-menu-theme', 'light');
            }
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('ar-menu-theme');
            if (savedTheme === 'dark') {
                document.body.classList.remove('light-theme');
                document.body.classList.add('dark-theme');
                themeBtn.textContent = '';
            }
        }

        function toggleInfoCard() {
            isInfoMinimized = !isInfoMinimized;

            if (isInfoMinimized) {
                infoCard.classList.add('minimized');
                document.body.classList.add('info-minimized');
                minimizeBtn.textContent = '';
                minimizeBtn.title = 'Expand';
            } else {
                infoCard.classList.remove('minimized');
                document.body.classList.remove('info-minimized');
                minimizeBtn.textContent = '';
                minimizeBtn.title = 'Minimize';
            }
        }

        function updateInfoFavoriteButton() {
            if (currentItem) {
                infoFavBtn.textContent = favorites.includes(currentItem.id) ? '' : '';
            }
        }

        // FORMAT PRICE IN PKR
        function formatPrice(price) {
            return `Rs. ${price.toLocaleString('en-PK')}`;
        }

        // SEARCH FUNCTIONS
        function saveSearchQuery(query) {
            localStorage.setItem('ar-menu-search-query', query);
        }

        function loadSearchQuery() {
            return localStorage.getItem('ar-menu-search-query') || '';
        }

        function closeSearch() {
            searchContainer.classList.remove('show');
            // Don't clear search value - keep it for memory
            searchResults.classList.remove('show');
            searchClear.classList.remove('show');
            infoCard.classList.remove('search-active');
            document.body.classList.remove('search-active');
            // Save current search query
            saveSearchQuery(searchBar.value);
        }

        function toggleSearch() {
            const isVisible = searchContainer.classList.contains('show');
            if (isVisible) {
                closeSearch();
            } else {
                searchContainer.classList.add('show');
                searchBar.focus();
                infoCard.classList.add('search-active');
                document.body.classList.add('search-active');
                // Restore previous search and trigger search if there was text
                const savedQuery = loadSearchQuery();
                if (savedQuery) {
                    searchBar.value = savedQuery;
                    performSearch(savedQuery);
                }
            }
        }

        function performSearch(query) {
            // Save query to localStorage
            saveSearchQuery(query);

            if (!query || query.trim().length < 2) {
                searchResults.classList.remove('show');
                searchClear.classList.remove('show');
                return;
            }

            searchClear.classList.add('show');
            const results = [];
            const lowerQuery = query.toLowerCase();

            // Search through all restaurants and items
            RESTAURANTS.forEach(restaurant => {
                // Check if restaurant name matches
                if (restaurant.name.toLowerCase().includes(lowerQuery)) {
                    restaurant.categories.forEach(category => {
                        category.items.forEach(item => {
                            results.push({
                                type: 'restaurant',
                                item: item,
                                restaurant: restaurant,
                                category: category
                            });
                        });
                    });
                } else {
                    // Search items
                    restaurant.categories.forEach(category => {
                        category.items.forEach(item => {
                            if (item.name.toLowerCase().includes(lowerQuery)) {
                                results.push({
                                    type: 'item',
                                    item: item,
                                    restaurant: restaurant,
                                    category: category
                                });
                            }
                        });
                    });
                }
            });

            renderSearchResults(results);
        }

        function renderSearchResults(results) {
            if (results.length === 0) {
                searchResults.innerHTML = '<div class="search-no-results">No results found</div>';
                searchResults.classList.add('show');
                return;
            }

            searchResults.innerHTML = results.slice(0, 10).map(result => {
                const { item, restaurant, category } = result;
                return `
                    <div class="search-result-item" data-item-id="${item.id}" data-restaurant-id="${restaurant.id}">
                        <div class="search-result-name">${item.name}</div>
                        <div class="search-result-meta">${formatPrice(item.price)}  ${restaurant.name.substring(2)}</div>
                    </div>
                `;
            }).join('');

            searchResults.classList.add('show');

            // Add click handlers
            document.querySelectorAll('.search-result-item').forEach(el => {
                el.addEventListener('click', () => {
                    const itemId = el.dataset.itemId;
                    const restaurantId = el.dataset.restaurantId;
                    selectItemFromSearch(itemId, restaurantId);
                });
            });
        }

        function selectItemFromSearch(itemId, restaurantId) {
            const restaurant = RESTAURANTS.find(r => r.id === restaurantId);
            if (!restaurant) return;

            let foundItem = null;
            let foundCategory = null;

            restaurant.categories.forEach(category => {
                const item = category.items.find(i => i.id === itemId);
                if (item) {
                    foundItem = item;
                    foundCategory = category;
                }
            });

            if (foundItem && foundCategory) {
                selectItem(foundItem, restaurant, foundCategory);
                toggleSearch(); // Close search
            }
        }

        // SHARE FUNCTIONS
        function openShareModal() {
            shareModal.classList.add('show');
            shareOverlay.classList.add('show');
        }

        function closeShareModal() {
            shareModal.classList.remove('show');
            shareOverlay.classList.remove('show');
        }

        function shareItem(platform) {
            if (!currentItem) return;
            
            const shareUrl = window.location.origin + window.location.pathname + `?restaurant=${currentRestaurant.id}&item=${currentItem.id}`;
            const shareText = `Check out ${currentItem.name} in AR! ${formatPrice(currentItem.price)}`;
            
            switch(platform) {
                case 'whatsapp':
                    window.open(`https://wa.me/?text=${encodeURIComponent(shareText + ' ' + shareUrl)}`, '_blank');
                    break;
                case 'twitter':
                    window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${encodeURIComponent(shareUrl)}`, '_blank');
                    break;
                case 'copy':
                    copyToClipboard(shareUrl);
                    break;
                case 'native':
                    if (navigator.share) {
                        navigator.share({ title: currentItem.name, text: shareText, url: shareUrl }).catch(() => copyToClipboard(shareUrl));
                    } else {
                        copyToClipboard(shareUrl);
                    }
                    break;
            }
            
            closeShareModal();
        }

        function copyToClipboard(text) {
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text).then(() => {
                    showToast('Link copied to clipboard!', 'success');
                }).catch(() => fallbackCopy(text));
            } else {
                fallbackCopy(text);
            }
        }

        function fallbackCopy(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                document.execCommand('copy');
                showToast('Link copied!', 'success');
            } catch (err) {
                prompt('Copy this link:', text);
            }
            document.body.removeChild(textArea);
        }

        // EVENT LISTENERS
        welcomeButton.addEventListener('click', () => {
            welcomeOverlay.classList.remove('show');
            localStorage.setItem('ar-menu-welcome-seen', 'true');
            // Show tutorial after welcome closes
            setTimeout(() => {
                tutorialOverlay.classList.add('show');
            }, 300);
        });

        tutorialClose.addEventListener('click', () => tutorialOverlay.classList.remove('show'));
        helpBtn.addEventListener('click', () => tutorialOverlay.classList.add('show'));

        loginTab.addEventListener('click', () => {
            loginTab.classList.add('active');
            signupTab.classList.remove('active');
            loginForm.classList.add('active');
            signupForm.classList.remove('active');
        });

        signupTab.addEventListener('click', () => {
            signupTab.classList.add('active');
            loginTab.classList.remove('active');
            signupForm.classList.add('active');
            loginForm.classList.remove('active');
        });

        loginForm.addEventListener('submit', handleLogin);
        signupForm.addEventListener('submit', handleSignup);
        authCloseBtn.addEventListener('click', closeAuth);
        userBtn.addEventListener('click', () => {
            closeSearch();
            if (currentUser) {
                // If logged in, open menu to show user section
                openMenu();
            } else {
                // If not logged in, open auth modal
                openAuth();
            }
        });

        menuBtn.addEventListener('click', () => {
            closeSearch();
            openMenu();
        });
        cartBtn.addEventListener('click', () => {
            closeSearch();
            openCart();
        });
        favBtn.addEventListener('click', () => {
            closeSearch();
            openMenu();
            showFavorites();
        });
        menuOverlay.addEventListener('click', () => { closeMenu(); closeCart(); closeCheckout(); });
        cartOverlay.addEventListener('click', () => { closeCart(); closeCheckout(); });
        
        themeBtn.addEventListener('click', toggleTheme);
        minimizeBtn.addEventListener('click', toggleInfoCard);
        infoFavBtn.addEventListener('click', () => {
            if (currentItem) {
                toggleFavorite(currentItem.id);
            }
        });
        qtyMinus.addEventListener('click', () => updateQuantity(-1));
        qtyPlus.addEventListener('click', () => updateQuantity(1));
        ratingSection.addEventListener('click', showReviews);
        reviewsOverlay.addEventListener('click', closeReviews);
        reviewsClose.addEventListener('click', closeReviews);

        cartClose.addEventListener('click', closeCart);
        checkoutBtn.addEventListener('click', openCheckout);
        checkoutClose.addEventListener('click', closeCheckout);
        checkoutForm.addEventListener('submit', placeOrder);
        confirmationDone.addEventListener('click', () => orderConfirmationOverlay.classList.remove('show'));

        document.querySelectorAll('.payment-method').forEach(method => {
            method.addEventListener('click', () => {
                selectedPaymentMethod = method.dataset.method;
                selectedPaymentGST = parseFloat(method.dataset.gst);
                document.querySelectorAll('.payment-method').forEach(el => el.classList.remove('active'));
                method.classList.add('active');
                placeOrderBtn.disabled = !tableNumber.value.trim();
                
                const { subtotal, gst, gstRate, total } = calculateCartTotals();
                document.getElementById('checkoutGST').textContent = formatPrice(gst);
                document.getElementById('checkoutGSTRate').textContent = gstRate;
                document.getElementById('checkoutTotal').textContent = formatPrice(total);
            });
        });

        tableNumber.addEventListener('input', () => {
            placeOrderBtn.disabled = !tableNumber.value.trim() || !selectedPaymentMethod;
        });

        arButton.addEventListener('click', () => viewer.activateAR());
        addToCartButton.addEventListener('click', () => addToCart(currentItem, currentQuantity));
        shareBtn.addEventListener('click', openShareModal);
        shareClose.addEventListener('click', closeShareModal);
        shareOverlay.addEventListener('click', closeShareModal);
        searchBtn.addEventListener('click', toggleSearch);
        
        searchBar.addEventListener('input', (e) => {
            performSearch(e.target.value);
        });
        
        searchClear.addEventListener('click', () => {
            searchBar.value = '';
            searchResults.classList.remove('show');
            searchClear.classList.remove('show');
            searchBar.focus();
            // Clear saved search query
            saveSearchQuery('');
        });

        // Close search when clicking outside
        document.addEventListener('click', (e) => {
            const isSearchVisible = searchContainer.classList.contains('show');
            if (!isSearchVisible) return;

            // Check if click is outside search container and search button
            const clickedInsideSearch = searchContainer.contains(e.target);
            const clickedSearchBtn = searchBtn.contains(e.target);

            if (!clickedInsideSearch && !clickedSearchBtn) {
                closeSearch();
            }
        });

        document.querySelectorAll('.share-option').forEach(option => {
            option.addEventListener('click', () => shareItem(option.dataset.platform));
        });

        allTab.addEventListener('click', showAllItems);
        favTab.addEventListener('click', showFavorites);

        viewer.addEventListener('load', () => {
            document.getElementById('loadingOverlay').classList.remove('show');
            console.log(' Model loaded successfully');
            if (window.loadingTimeout) {
                clearTimeout(window.loadingTimeout);
            }
        });

        viewer.addEventListener('error', (event) => {
            document.getElementById('loadingOverlay').classList.remove('show');
            console.error(' Model loading error:', event);
            showToast('Failed to load 3D model. Check your internet connection.', 'error');
            if (window.loadingTimeout) {
                clearTimeout(window.loadingTimeout);
            }
        });

        viewer.addEventListener('progress', (event) => {
            const percent = Math.round(event.detail.totalProgress * 100);
            document.getElementById('loadingProgressBar').style.width = percent + '%';
            console.log(` Loading: ${percent}%`);
        });

        // INITIALIZATION
        function init() {
            console.log(' AR Menu MVP - Complete Version');
            console.log(' Cart System |  User Auth |  Checkout |  iOS AR Fixed');

            // Set initial body class for minimized info card
            if (isInfoMinimized) {
                document.body.classList.add('info-minimized');
            }

            detectIOS();
            loadFromStorage();
            loadTheme();
            renderUserSection();
            renderAllItems();
            renderFavorites();
            
            const hasSeenWelcome = localStorage.getItem('ar-menu-welcome-seen');
            if (!hasSeenWelcome) {
                welcomeOverlay.classList.add('show');
            }
            
            const firstRestaurant = RESTAURANTS[0];
            const firstItem = firstRestaurant.categories[0].items[0];
            selectItem(firstItem, firstRestaurant, firstRestaurant.categories[0]);
            expandedRestaurants.push(firstRestaurant.id);
            renderAllItems();
            
            console.log(' All systems ready!');
        }

        init();
    </script>

</body>
</html>